{% extends "base.html" %}
{% block title %}제출 #{{ submission_detail.submission.id }} - Nekonic OJ{% endblock title %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>제출 #{{ submission_detail.submission.id }}</h1>
    <div>
        <a href="/problems/{{ submission_detail.submission.problem_id }}/status" class="btn btn-outline-primary">채점 현황으로</a>
    </div>
</div>

<!-- 제출 정보 카드 -->
<div class="card mb-4">
    <div class="card-header
    {% if submission_detail.submission.status == 'ACCEPTED' %}bg-success
    {% elif submission_detail.submission.status == 'WRONG_ANSWER' %}bg-danger
    {% elif submission_detail.submission.status == 'TIME_LIMIT_EXCEEDED' or submission_detail.submission.status == 'MEMORY_LIMIT_EXCEEDED' %}bg-warning
    {% else %}bg-secondary
    {% endif %}">
        <h5 class="mb-0">제출 정보</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <table class="table table-borderless mb-0">
                    <tbody>
                    <tr>
                        <th style="width: 150px;">사용자</th>
                        <td>{{ submission_detail.submission.username }}</td>
                    </tr>
                    <tr>
                        <th>언어</th>
                        <td>{{ submission_detail.submission.language }}</td>
                    </tr>
                    <tr>
                        <th>결과</th>
                        <td>
                <span class="badge
                  {% if submission_detail.submission.status == 'ACCEPTED' %}bg-success
                  {% elif submission_detail.submission.status == 'WRONG_ANSWER' %}bg-danger
                  {% elif submission_detail.submission.status == 'TIME_LIMIT_EXCEEDED' %}bg-warning text-dark
                  {% elif submission_detail.submission.status == 'MEMORY_LIMIT_EXCEEDED' %}bg-warning text-dark
                  {% elif submission_detail.submission.status == 'RUNTIME_ERROR' %}bg-danger
                  {% elif submission_detail.submission.status == 'COMPILATION_ERROR' %}bg-warning
                  {% elif submission_detail.submission.status == 'PENDING' %}bg-secondary
                  {% elif submission_detail.submission.status == 'JUDGING' %}bg-info
                  {% else %}bg-secondary
                  {% endif %}">
                  {% if submission_detail.submission.status == 'ACCEPTED' %}정답
                  {% elif submission_detail.submission.status == 'WRONG_ANSWER' %}오답
                  {% elif submission_detail.submission.status == 'TIME_LIMIT_EXCEEDED' %}시간 초과
                  {% elif submission_detail.submission.status == 'MEMORY_LIMIT_EXCEEDED' %}메모리 초과
                  {% elif submission_detail.submission.status == 'RUNTIME_ERROR' %}런타임 에러
                  {% elif submission_detail.submission.status == 'COMPILATION_ERROR' %}컴파일 에러
                  {% elif submission_detail.submission.status == 'PENDING' %}대기 중
                  {% elif submission_detail.submission.status == 'JUDGING' %}채점 중
                  {% else %}{{ submission_detail.submission.status }}
                  {% endif %}
                </span>
                        </td>
                    </tr>
                    <tr>
                        <th>점수</th>
                        <td>{{ submission_detail.submission.score | default(value=0) }}/100</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-md-6">
                <table class="table table-borderless mb-0">
                    <tbody>
                    <tr>
                        <th style="width: 150px;">실행 시간</th>
                        <td>{% if submission_detail.submission.execution_time %}{{ submission_detail.submission.execution_time }}ms{% else %}-{% endif %}</td>
                    </tr>
                    <tr>
                        <th>메모리</th>
                        <td>{% if submission_detail.submission.memory_usage %}{{ submission_detail.submission.memory_usage }}KB{% else %}-{% endif %}</td>
                    </tr>
                    <tr>
                        <th>제출 시간</th>
                        <td>{{ submission_detail.submission.submitted_at }}</td>
                    </tr>
                    <tr>
                        <th>채점 완료</th>
                        <td>{% if submission_detail.submission.judged_at %}{{ submission_detail.submission.judged_at }}{% else %}-{% endif %}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- 컴파일 에러 메시지 -->
{% if submission_detail.submission.compile_message %}
<div class="card mb-4">
    <div class="card-header bg-warning">
        <h5 class="mb-0">컴파일 에러</h5>
    </div>
    <div class="card-body">
        <pre class="mb-0"><code>{{ submission_detail.submission.compile_message }}</code></pre>
    </div>
</div>
{% endif %}

<!-- 런타임 에러 메시지 -->
{% if submission_detail.submission.runtime_error_message %}
<div class="card mb-4">
    <div class="card-header bg-danger">
        <h5 class="mb-0">런타임 에러</h5>
    </div>
    <div class="card-body">
        {% if submission_detail.submission.runtime_error_type %}
        <p><strong>에러 타입:</strong> {{ submission_detail.submission.runtime_error_type }}</p>
        {% endif %}
        <pre class="mb-0"><code>{{ submission_detail.submission.runtime_error_message }}</code></pre>
    </div>
</div>
{% endif %}

<!-- 테스트케이스 결과 -->
{% if submission_detail.testcase_results %}
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">테스트케이스 결과 ({{ submission_detail.submission.passed_testcases }}/{{ submission_detail.submission.total_testcases }})</h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                <tr>
                    <th>번호</th>
                    <th>결과</th>
                    <th>실행 시간</th>
                    <th>메모리</th>
                    <th>에러 메시지</th>
                </tr>
                </thead>
                <tbody>
                {% for testcase in submission_detail.testcase_results %}
                <tr>
                    <td>#{{ testcase.testcase_number }}</td>
                    <td>
              <span class="badge
                {% if testcase.status == 'ACCEPTED' %}bg-success
                {% elif testcase.status == 'WRONG_ANSWER' %}bg-danger
                {% elif testcase.status == 'TIME_LIMIT_EXCEEDED' %}bg-warning text-dark
                {% elif testcase.status == 'MEMORY_LIMIT_EXCEEDED' %}bg-warning text-dark
                {% elif testcase.status == 'RUNTIME_ERROR' %}bg-danger
                {% else %}bg-secondary
                {% endif %}">
                {% if testcase.status == 'ACCEPTED' %}정답
                {% elif testcase.status == 'WRONG_ANSWER' %}오답
                {% elif testcase.status == 'TIME_LIMIT_EXCEEDED' %}시간 초과
                {% elif testcase.status == 'MEMORY_LIMIT_EXCEEDED' %}메모리 초과
                {% elif testcase.status == 'RUNTIME_ERROR' %}런타임 에러
                {% else %}{{ testcase.status }}
                {% endif %}
              </span>
                    </td>
                    <td>{% if testcase.execution_time %}{{ testcase.execution_time }}ms{% else %}-{% endif %}</td>
                    <td>{% if testcase.memory_usage %}{{ testcase.memory_usage }}KB{% else %}-{% endif %}</td>
                    <td>
                        {% if testcase.error_message %}
                        <span class="text-danger">{{ testcase.error_message }}</span>
                        {% else %}-{% endif %}
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}

{% endblock content %}
