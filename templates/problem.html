{% extends "base.html" %}

{% block title %}{{ problem.id }}번: {{ problem.meta.title }} - Nekonic OJ{% endblock title %}

{% block content %}
<!-- 상단 메뉴 -->
<ul class="nav nav-tabs mb-4">
  <li class="nav-item"><a class="nav-link active" href="#" onclick="showTab('problem-tab', this); return false;">문제</a></li>
  <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('submit-tab', this); return false;">제출</a></li>
  <li class="nav-item"><a class="nav-link" href="/problems/{{ problem.id }}/status">채점 현황</a></li>
  <li class="nav-item"><a class="nav-link" href="/boards/3?problem={{ problem.id }}">질문게시판</a></li>
</ul>

<!-- 문제 탭 내용 -->
<div id="problem-tab">
  <!-- 문제 제목 -->
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div class="d-flex align-items-center">
      <h1 class="me-3 mb-0">{{ problem.meta.title }}</h1>
      {% for tag in problem.meta.tags %}
      <span class="badge rounded-pill bg-secondary fw-normal">{{ tag }}</span>
      {% endfor %}
    </div>
    {% if current_user %}
    <a href="/boards/3/posts/new?problem_id={{ problem.id }}" class="btn btn-outline-primary">
      <i class="bi bi-question-circle"></i> 질문하기
    </a>
    {% endif %}
  </div>

  <!-- 문제 정보 테이블 -> 카드로 변경 -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row text-center">
        <div class="col"><strong>시간 제한</strong><br>{{ problem.meta.time_limit }}ms</div>
        <div class="col"><strong>메모리 제한</strong><br>{{ problem.meta.memory_limit }}MB</div>
        <div class="col"><strong>제출</strong><br>{{ problem.total_submits }}</div>
        <div class="col"><strong>정답</strong><br>{{ problem.correct_submits }}</div>
        <div class="col"><strong>정답 비율</strong><br>{{ problem.accuracy }}</div>
      </div>
    </div>
  </div>

  <!-- 문제 내용 -->
  <div id="problem-content">
    <div class="problem-section mb-5">
      <h3 class="border-bottom pb-2 mb-3">문제</h3>
      {{ problem.content | safe }}
    </div>

    <!-- 예제 입출력 -->
    {% if problem.example_inputs or problem.example_outputs %}
    <div class="row">
      {% for i in range(end=problem.example_inputs | length) %}
      <div class="col-md-6 mb-3">
        <div class="card">
          <div class="card-header"><strong>예제 입력 {{ i + 1 }}</strong></div>
          <div class="card-body">
            <pre class="mb-0"><code>{{ problem.example_inputs[i] | default(value="") }}</code></pre>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-3">
        <div class="card">
          <div class="card-header"><strong>예제 출력 {{ i + 1 }}</strong></div>
          <div class="card-body">
            <pre class="mb-0"><code>{{ problem.example_outputs[i] | default(value="") }}</code></pre>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </div>
</div>

<!-- 제출 탭 내용 -->
<div id="submit-tab" style="display: none;">
  {% if current_user %}
  <form method="post" action="/problems/{{ problem.id }}/submit">
    <div class="mb-3">
      <label for="language-select" class="form-label">언어</label>
      <select class="form-select" id="language-select" name="language" required>
        <option value="cpp">C++</option>
        <option value="python">Python</option>
        <option value="java">Java</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="source-code-textarea" class="form-label">소스 코드</label>
      <textarea class="form-control" id="source-code-textarea" name="source_code" rows="20" required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">제출</button>
  </form>
  {% else %}
  <div class="alert alert-warning">
    <a href="/login">로그인</a>이 필요합니다.
  </div>
  {% endif %}
</div>

{% endblock content %}
